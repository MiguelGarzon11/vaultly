---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Register">
  <main
    class="flex flex-col justify-center items-center w-full h-auto bg-back sm:gap-10 caret-transparent py-26 md:py-10"
  >
    <div
      class="fixed inset-0 bg-back/80 backdrop-blur-sm md:backdrop-blur-none md:bg-transparent z-50 w-full h-20 rounded-b-4xl"
    >
      <a
        href="/"
        class="absolute left-6 top-7 sm:top-10 sm:left-10 flex flex-row justify-center items-center gap-2 hover:scale-105 transition active:scale-95 hover:text-secondary active:text-secondary"
      >
        <svg class="w-4 h-4 sm:w-6 sm:h-6">
          <use href="/assets/icons/back.svg"></use>
        </svg>
        <p class="text-lg font-medium">Inicio</p>
      </a>

      <a
        href="/login"
        class="absolute right-6 top-7 sm:top-10 sm:right-10 flex flex-row justify-center items-center gap-2 hover:scale-105 transition active:scale-95 hover:text-secondary active:text-secondary"
      >
        <p class="text-lg font-medium">Iniciar sesión</p>
        <svg class="w-4 h-4 sm:w-6 sm:h-6">
          <use href="/assets/icons/go.svg"></use>
        </svg>
      </a>
      <hr class="fixed w-full text-text top-20 sm:hidden" />
    </div>

    <div
      class="flex flex-row justify-center items-center gap-4 sm:gap-5"
      transition:name="vaultly"
    >
      <img
        src="/assets/icons/icon.svg"
        alt="Vaultly Logo"
        class="w-14 h-14 sm:w-16 sm:h-16"
      />
      <h1 class="text-text font-extrabold text-5xl">Vaultly</h1>
    </div>

    <div
      class="w-[90%] sm:w-[70%] lg:w-[800px] h-auto flex flex-col justify-center items-center md:flex-row bg-dark-back rounded-tl-4xl rounded-tr-4xl rounded-bl-[90px] rounded-br-4xl overflow-hidden"
    >
      <div
        class="bg-dark-back w-full md:w-[50%] h-auto sm:rounded-l-4xl flex flex-col justify-start md:justify-center items-start p-14 gap-5"
      >
        <h2 class="text-3xl font-bold text-text text-balance">
          Regístrate hoy y comienza a dominar tus finanzas.
        </h2>
        <p
          class="text-secondary-text text-balance font-sans font-medium text-lg"
        >
          Organiza, analiza y crece.
        </p>
      </div>
      <div
        class="bg-primary w-full h-full md:w-[60%] rounded-tl-[70px] rounded-bl-[90px] flex flex-col justify-around items-center"
      >
        <form class="flex flex-col gap-4 sm:gap-6 md:gap-4 w-full px-12 py-15 sm:p-14">
          <label for="email">Email</label>
          <input
            type="email"
            name="email"
            id="email"
            placeholder="myemail@example.com"
            required
          />
          <label for="password">Password</label>
          <input
            type="password"
            name="password"
            id="pass"
            placeholder="Your password"
            required
          />
          <input
            type="password"
            name="cPassword"
            id="cPass"
            placeholder="Confirm your password"
            required
          />
          <a href="" class="text-white/80 text-sm hover:text-white/100"
            >¿olvido su contraseña?</a
          >
          <button type="submit" id="button">Crear cuenta</button>
          <a 
            href="/login"
            class="text-white/80 text-sm hover:text-white/100 text-center"
            >¿Ya tiene una cuenta?</a
          >
        </form>
      </div>
    </div>
  </main>
</Layout>

<script>
  import { actions } from "astro:actions";

  const form = document.querySelector("form");
  form?.addEventListener("submit", async (event) => {
    event.preventDefault();
    const formData = new FormData(form);
    const result = await actions.register(formData);

    if (result.data?.ok === true) {
      setTimeout(() => {
        alert(result.data?.message)
        window.location.href = `/register/confirmcode?username=${encodeURIComponent(result.data?.username!)}`;
      }, 500);
    } else {
      alert(result.data?.message)
      console.log("Error:", result.data?.message);
    }
  });
</script>
